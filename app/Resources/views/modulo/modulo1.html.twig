{% extends 'base.html.twig' %}

{% block title %}  Güilder - Organizador {% endblock %}
 {% block mod1 %}  <li class="active"><a href="{{ path('modulo1') }}"> Organizar Cursada</a></li> {% endblock %}
   {% block extras %}
   {{parent()}}
   <link rel="stylesheet" href="../styles/timetablejs.css">
   <link rel="stylesheet" href="../styles/modulos.css" type="text/css" >
   <script src="../../scripts/timetable.min.js"></script>
 {% endblock %}
{% block body %}
<h2> Módulo 1 </h2>

 <div class="hero-unit">
      <h1 id="encabezado">¡Organiza tu cursada!</h1>
    </div>
<div class="container" >
<div id="tablas" class="container">
        
        {#    Tabla de materias con botones  #}
        <div id="tablaMaterias">
            <table class="table table-striped" >
                <thead style="background-color: cornflowerblue;">
                    <tr>
                        <th scope="col">Materias</th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody id="bodyMaterias">
                    {% for materia in materias %}   
                    <tr class="table-light" >
                        <td>{{materia.nombre}}</td>
                        <td><button id="btMateria" type="button" value="{{materia.codigo}}"  class="btn btn-secondary">Añadir</button></td>
                    </tr>
                    {% endfor%}
                </tbody>
            </table>
        </div>
        <div id="tablaComisiones">
            <table id="bodyComisiones" class="table table-striped" >
                <thead style="background-color: cornflowerblue;">
                    <tr>
                        <th scope="col">Comision</th>
                        <th scope="col">Profesor</th>
                        <th scope="col">Desde</th>
                        <th scope="col">Hasta</th>
                        <th scope="col">Día</th>
                        <th scope="col"></th>
                        
                    </tr>
                </thead>
                <tbody>
                    <tr><td><td/><td><td/><td><td/></tr>
                </tbody>
            </table>
        </div>
</div>
            
    <div class="timetable" style="float: bottom">
        <aside>
            <ul>
                <li>
                    <span class="row-heading">Lunes</span>
                </li>
                <li><span class="row-heading">Martes</span></li>
                <li><span class="row-heading">Miércoles</span></li>
                <li><span class="row-heading">Jueves</span></li>
                <li><span class="row-heading">Viernes</span></li>
                <li><span class="row-heading">Sábado</span></li>
        </aside>
        <section>
            <time>
                <header>
                    <ul>
                        <li>
                            <span class="time-label">08:00</span>
                        </li>
                        <li>
                            <span class="time-label">09:00</span>
                        </li>
                        <li>
                            <span class="time-label">10:00</span>
                        </li>
                        <li>
                            <span class="time-label">11:00</span>
                        </li>
                        <li>
                            <span class="time-label">12:00</span>
                        </li>
                        <li>
                            <span class="time-label">13:00</span>
                        </li>
                        <li>
                            <span class="time-label">14:00</span>
                        </li>
                        <li>
                            <span class="time-label">15:00</span>
                        </li>
                        <li>
                            <span class="time-label">16:00</span>
                        </li>
                        <li>
                            <span class="time-label">17:00</span>
                        </li>
                        <li>
                            <span class="time-label">18:00</span>
                        </li>
                        <li>
                            <span class="time-label">19:00</span>
                        </li>
                        <li>
                            <span class="time-label">20:00</span>
                        </li>
                        <li>
                            <span class="time-label">21:00</span>
                        </li>
                        <li>
                            <span class="time-label">22:00</span>
                        </li>
                    </ul>
                </header>
                <ul class="room-timeline">
                    {#<script>#}
                    <li>
                        {#<a title="Sightseeing" href="#" class="time-entry" style="width: 10.2941%; left: 10.2941%;">
                            <small>Sightseeing</small></a>#}
                    </li>
                    <li>
                        
                    </li>
                    <li>
                        
                    </li>
                    <li>
                        
                    </li>
                    
                    <li>    
                    </li>
                    
                    <li>
                    </li>
{#                    </script>#}
                </ul>
            </time>
        </section>
    </div>
                </div>
                
    
    <script src="//www.google-analytics.com/analytics.js"></script><script src="../scripts/timetable.min.js"></script>

    <script>
        var timetable = new Timetable();
        timetable.setScope(8,22);
        timetable.addLocations(['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado']);
        var renderer = new Timetable.Renderer(timetable);
        renderer.draw('.timetable');
    </script>

    
    <script>
        var comisiones;
        $("#bodyMaterias").find("button").click(function(){
            var param = $(this).val();
            {# Realizo un get utilizando AJAX enviando como parametro el codigo de la materia #}
            $.get("{{url('agregar_comisiones')}}",{codigo:param} ,  function(mydata){
                comisiones=$.parseJSON(mydata);
                {# Remuevo todas las filas menos la cabecera #}
                $('#bodyComisiones tr:not(:first-child)').remove();
                
                comisiones.forEach(function(datos){
                    console.log(datos);
                    {# Por cada comision muestros los datos relevantes accediendo al JSON #}
                    $("#bodyComisiones tr:last").after('<tr> class="table-light" <th scope="row">'+
                    datos[1]+'</td><td>'+ datos[0]+
                    '</td><td>'+ datos[2]+':'+datos[3]+
                    '</td><td>'+ datos[4]+':'+datos[5]+'</td><td>'+datos[6]+
                    '</td><td><button type="button" class="btn btn-secondary" onClick="agregarTimeTable('+datos[1]+')"> Agregar </button></td></tr>');
                })
            });
        });

    </script>
    <script>
        function agregarTimeTable(nComi){
            {# Busco en el JSON todas las comisiones que sean iguales a nComi y las añado al timetable #}
            comisiones.forEach(function(com){
                if (nComi==com[1]){
                    timetable.addEvent(com[7], com[6],new Date(2015,7,17,com[2], com[3]), new Date(2015,7,17,com[4],com[5]));
                };
            });
        renderer = new Timetable.Renderer(timetable);
        renderer.draw('.timetable'); 
        };
    </script>
{% endblock %}