{% extends 'base.html.twig' %}

{% block title %}  Güilder - Organizador {% endblock %}
 {% block mod1 %}  <li class="active"><a href="{{ path('modulo1') }}"> Organizar Cursada</a></li> {% endblock %}
   {% block extras %}
   {{parent()}}
   <link rel="stylesheet" href="../styles/timetablejs.css">
   <link rel="stylesheet" href="../styles/modulos.css" type="text/css" >
   <script src="../../scripts/timetable.min.js"></script>
 {% endblock %}
{% block body %}
<div class=contenedorModulo1>
    <div class="titulo">
        <h1>¡Organiza tu cursada!</h1>
    </div>

<!-- <div class="container" > -->
<div class="content">
<!--<div id="tablas" class="container"> -->
    <div id="tablas" class="containerTablas">
        
        {#    Tabla de materias con botones  #}
        <div id="tablaMaterias">
            <table class="table table-striped" >
                <thead>
                    <tr>
                        <th scope="col">Materias</th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody id="bodyMaterias">
                    {% for materia in materias %}   
                    <tr class="table-light" >
                        <td>{{materia.nombre}}</td>
                        <td><button type="button" value="{{materia.idmateria}}"  class="btn btn-secondary">Añadir</button></td>
                    </tr>
                    {% endfor%}
                </tbody>
            </table>
        </div>
        <div id="tablaComisiones">
            <table id="bodyComisiones" class="table table-striped" >
                <thead>
                    <tr>
                        <th scope="col">Comision</th>
                        <th scope="col">Profesor</th>
                        <th scope="col">Desde</th>
                        <th scope="col">Hasta</th>
                        <th scope="col">Día</th>
                        <th scope="col"></th>
                        
                    </tr>
                </thead>
                <tbody>
                    <tr><td><td/><td><td/><td><td/></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<div class="content">     
    <div class="timetable" >
        <aside> 
            <ul>
                <li>
                    <span class="row-heading">Lunes</span>
                </li>
                <li><span class="row-heading">Martes</span></li>
                <li><span class="row-heading">Miércoles</span></li>
                <li><span class="row-heading">Jueves</span></li>
                <li><span class="row-heading">Viernes</span></li>
                <li><span class="row-heading">Sábado</span></li>
        </aside>
        <section id="time">
            <time>
                <header>
                    <ul>
                        <li>
                            <span class="time-label">08:00</span>
                        </li>
                        <li>
                            <span class="time-label">09:00</span>
                        </li>
                        <li>
                            <span class="time-label">10:00</span>
                        </li>
                        <li>
                            <span class="time-label">11:00</span>
                        </li>
                        <li>
                            <span class="time-label">12:00</span>
                        </li>
                        <li>
                            <span class="time-label">13:00</span>
                        </li>
                        <li>
                            <span class="time-label">14:00</span>
                        </li>
                        <li>
                            <span class="time-label">15:00</span>
                        </li>
                        <li>
                            <span class="time-label">16:00</span>
                        </li>
                        <li>
                            <span class="time-label">17:00</span>
                        </li>
                        <li>
                            <span class="time-label">18:00</span>
                        </li>
                        <li>
                            <span class="time-label">19:00</span>
                        </li>
                        <li>
                            <span class="time-label">20:00</span>
                        </li>
                        <li>
                            <span class="time-label">21:00</span>
                        </li>
                        <li>
                            <span class="time-label">22:00</span>
                        </li>
                    </ul>
                </header>
                <ul class="room-timeline">
                    <li>    
                    </li>
                    <li>
                    </li>
                    <li>
                    </li>
                    <li>
                    </li>
                    <li>    
                    </li>
                    <li>
                    </li>
                </ul>
            </time>
        </section>
    </div>
</div>
</div>
    <script src="//www.google-analytics.com/analytics.js"></script><script src="../scripts/timetable.min.js"></script>

    <script>
        var timetable = new Timetable();
        timetable.setScope(8,22);
        timetable.addLocations(['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado']);
        var renderer = new Timetable.Renderer(timetable);
        renderer.draw('.timetable');
    </script>
    <script>
        var comisiones;
        $("#bodyMaterias").find("button").click(function(){
            var param = $(this).val();
            {# Realizo un get utilizando AJAX enviando como parametro el codigo de la materia #}
            $.get("{{url('agregar_comisiones')}}",{id:param} ,  function(mydata){
                comisiones=$.parseJSON(mydata);
                {# Remuevo todas las filas menos la cabecera #}
                $('#bodyComisiones tr:not(:first-child)').remove();
                
                comisiones.forEach(function(datos){
                    {# Por cada comision muestros los datos relevantes accediendo al JSON #}
                    $("#bodyComisiones tr:last").after('<tr> class="table-light" <th scope="row">'+
                    datos[1]+'</td><td>'+ datos[0]+
                    '</td><td>'+ datos[2]+':'+datos[3]+
                    '</td><td>'+ datos[4]+':'+datos[5]+'</td><td>'+datos[6]+
                    '</td><td><button type="button" class="btn btn-secondary" onClick="agregarTimeTable('+datos[1]+')"> Agregar </button></td></tr>');
                });
            });
        });

    </script>
    <script>
        function agregarTimeTable(nComi){
            {# Busco en el JSON todas las comisiones que sean iguales a nComi y las añado al timetable #}
            comisiones.forEach(function(com){
                if (nComi==com[1]){
                    timetable.addEvent(com[7], com[6],new Date(2015,7,17,com[2], com[3]), new Date(2015,7,17,com[4],com[5]));
                };
            });
        renderer = new Timetable.Renderer(timetable);
        renderer.draw('.timetable');
        };
    </script>
    <script>
        $(document).on('click','.time-entry',function(){
            var titulo=this.title;
            var newEvents=[];
            timetable.events.forEach(function (e){
                if (e.name!=titulo){
                    newEvents.push(e);
                }
            });
            timetable.events=newEvents;
            renderer.draw('.timetable');
        });
    </script>
{% endblock %}