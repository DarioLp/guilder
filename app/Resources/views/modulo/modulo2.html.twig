{% extends 'base.html.twig' %}

{% block title %} Güilder - Historial{% endblock %}
{% block mod2 %} <li class="active">
        <a href="{{ path('modulo2') }}"> Historial Horarios</a>
    </li>{% endblock %}
    {% block extras %}
        {{ parent() }}
        <link rel="stylesheet" type="text/css" href="{{asset('styles/calendar-heatmap.css')}}">
        <script src="{{ asset('scripts/moment.js')}}" charset="utf-8"></script>
        <script src="{{ asset('scripts/d3.js')}}" charset="utf-8"></script>

        <script src="{{ asset('scripts/calendar-heatmap.js') }}"></script>      
    {% endblock %}
    {% block body %}

        <div class="row">
            <div class="col-m-12">
                <h1>&nbsp;</h1>
            </div>
            <div class="hero-unit">
                <h1 id="encabezado">Historial de oferta Horaria</h1>
            </div>
        </div>
        <div class="container" id="contenedor">
            <div class="panel panel-primary" id="panel">
                <div class="panel-heading">
                    <h1 class="panel-title">Materias historicas</h1>
                </div> 

                <div class="panel-body">
                    <table>
                        <thead>
                            <tr>
                                <th>Materia</th>
                                <th>Año</th>
                                <th>Cuatrimestre</th>
                            </tr>
                            <tr>
                                <td><select class="form-control " id="materia" ><option value=""></option><option value="53">Taller de Ingeniería</option><option value="54">Problemas de la Historia Argentina</option><option value="55">Sistemas de Representación</option><option value="56">Matemática</option><option value="57">Taller de Lectura y Escritura</option><option value="58">Prácticas Culturales</option><option value="59">Fundamentos de Informática</option><option value="60">Matemática I</option><option value="61">Matemática II</option><option value="62">Algoritmos y Programación</option><option value="63">Organización y Arquitectura de Computadoras</option><option value="64">Sistemas Operativos I</option><option value="65">Física I</option><option value="66">Matemática III</option><option value="67">CTEDyA</option><option value="68">Base de Datos I</option><option value="69">Redes de Computadoras I</option><option value="70">Física II</option><option value="71">Metodologías de Programación I</option><option value="72">Información y Comunicaciones</option><option value="73">Ingeniería de Software I</option><option value="74">Redes de Computadras II</option><option value="75">Probabilidad y Estadística</option><option value="76">Proyecto Software</option><option value="77">Química General</option><option value="78">Metodologías de Programación II</option><option value="79">Seguridad de la Información</option><option value="80">Base de Datos II</option><option value="81">Ingeniería en Software II</option><option value="82">Sistemas Operativos II</option><option value="83">Seguridad en Aplicaciones</option><option value="84">Aplicaciones Móviles</option><option value="85">Administración de Proyectos</option><option value="86">Lenguajes Formales y Autómatas</option><option value="87">Programación en Tiempo Real</option><option value="88">Ingeniería Ambiental</option><option value="89">Sistemas y Organizaciones</option><option value="90">Legislación y Ejercicio Profesional de la Informática</option><option value="91">Gestión de Recursos Humanos</option><option value="92">Gestión de Calidad, Higiene y Seguridad</option><option value="93">Economía</option><option value="94">Práctica Profesional Supervisada</option><option value="95">Gobierno de IT y Auditoría de SI</option><option value="96">Datawarehouse y Bussiness Intelligence</option><option value="97">Gobierno Electrónico</option><option value="98">Aplicación Java sobre web</option><option value="99">Bioinformática</option><option value="100">Sistemas Distribuidos</option><option value="101">Tráfico en Redes</option></select>&nbsp</td>
                                <td><input class="form-control" type="number" id="year"  />&nbsp</td>
                                <td><input class="form-control" type="number" id="cuatrimestre" />&nbsp</td>
                            </tr>
                        <thead>
                    </table>

                    <button id="boton" type="button" class="btn btn-primary">Buscar</button>
                    <table id ="table" class="table table-striped">
                        <thead>
                            <tr>
                                <th scope="col">Numero de comision</th>
                                <th scope="col">Profesor</th>
                                <th scope="col">Año </th>
                                <th scope="col">Cuatrimestre</th>
                                <th scope="col">Dia </th>
                                <th scope="col">Hora de inicio</th>
                                <th scope="col">Hora de fin</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>


        </div>
        <script>
            var data = [{
                    "date": "2016-01-01",
                    "total": 17164,
                    "details": [
                        {"name": "Lunes",
                            "date": "2016-01-01 0:0:0",
                            "value": 0},
                        {"name": "Martes",
                            "date": "2016-01-01 0:0:0",
                            "value": 0},
                        {"name": "Miércoles",
                            "date": "2016-01-01 0:0:0",
                            "value": 0},
                        {"name": "Jueves",
                            "date": "2016-01-01 0:0:0",
                            "value": 0},
                        {"name": "Viernes",
                            "date": "2016-01-01 0:0:0",
                            "value": 0},
                        {"name": "Sábado",
                            "date": "2016-01-01 0:0:0",
                            "value": 0}]
                }]
            // Set custom color for the calendar heatmap
            var color = '#234acd';
            // Set overview type (choices are year, month and day)
            var overview = 'day';
            // Handler function
            var print = function (val) {
                console.log(val);
            };
            
            var int1= 8;
            var int2= 22;
            // Initialize calendar heatmap
            calendarHeatmap.init(data, color, overview, print,int1,int2);



            $('#boton').on('click', function () {
                $('tbody').remove();
                var mat = document.getElementById("materia").value;
                var year = document.getElementById("year").value;
                var cuatri = document.getElementById("cuatrimestre").value;
                var fecha = "2016-01-01 ";
                calendarHeatmap.data[0].details.length = 0;
                calendarHeatmap.data[0].details.push({"name": "Lunes", "date": "2016-01-01 0:0:0", "value": 0});
                calendarHeatmap.data[0].details.push({"name": "Martes", "date": "2016-01-01 0:0:0", "value": 0});
                calendarHeatmap.data[0].details.push({"name": "Miércoles", "date": "2016-01-01 0:0:0", "value": 0});
                calendarHeatmap.data[0].details.push({"name": "jueves", "date": "2016-01-01 0:0:0", "value": 0});
                calendarHeatmap.data[0].details.push({"name": "Viernes", "date": "2016-01-01 0:0:0", "value": 0});
                calendarHeatmap.data[0].details.push({"name": "Sabado", "date": "2016-01-01 0:0:0", "value": 0});
                var table = document.getElementById("table");
                var tbody = document.createElement("tbody");

                if (!((year >= 2011 && year <= 2017) || year == 0))
                    throw alert('Año ingresado invalido');
                if (!(cuatri == 1 || cuatri == 2 || cuatri == 0))
                    throw alert("Cuatrimestre invalido");
                
                $.post("{{url('m2')}}", {materia: mat, year: year, cuatri: cuatri}, function (rta) {
                    var com = JSON.parse(rta);

                    com.forEach(function (dato) {
                        var hilera = document.createElement("tr");
                        var c1 = document.createElement("td");
                        var t1 = document.createTextNode(dato.numero);
                        c1.appendChild(t1);
                        hilera.appendChild(c1);
                        var c2 = document.createElement("td");
                        var t2 = document.createTextNode(dato.profesor);
                        c2.appendChild(t2);
                        hilera.appendChild(c2);
                        var c3 = document.createElement("td");
                        var t3 = document.createTextNode(dato.year);
                        c3.appendChild(t3);
                        hilera.appendChild(c3);
                        var c4 = document.createElement("td");
                        var t4 = document.createTextNode(dato.cuatrimestre);
                        c4.appendChild(t4);
                        hilera.appendChild(c4);
                        var c5 = document.createElement("td");
                        var t5 = document.createTextNode(dato.dia);
                        c5.appendChild(t5);
                        hilera.appendChild(c5);
                        var c6 = document.createElement("td");
                        var t6 = document.createTextNode(dato.inicio);
                        c6.appendChild(t6);
                        hilera.appendChild(c6);
                        var c7 = document.createElement("td");
                        var t7 = document.createTextNode(dato.fin);
                        c7.appendChild(t7);
                        hilera.appendChild(c7);

                        tbody.appendChild(hilera);
                        calendarHeatmap.data[0].details.push({name: dato.dia, date: fecha.concat(dato.inicio), value: dato.segundos});
                    });
                    $(window).resize();
                    table.appendChild(tbody);

                }
                );
            });
            $(document).ready(function () {
                $('.calendar-heatmap').appendTo("#panel");
                $(window).resize();
            });
        </script>



    {% endblock %}

